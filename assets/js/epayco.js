(function(){var e,t,r,a,n;languages=new Array,e="https://api.secure.payco.co/",languages.es={errors:[{type:101,title:"[101] Datos ilegibles",description:"Los Datos son ilegibles compruebe la integridad del formulario"},{type:102,title:"[102] Error publicKey",description:"La publicKey es ilegible o no se tiene acceso, por favor compruebe"},{type:103,title:"[103] Campo erróneo o vacío",description:"El formato es incorrecto o esta vacío en:"}]},languages.en={errors:[{type:101,title:"[101] Illegible data",description:"The Data is illegible check the integrity of the form"},{type:102,title:"[102] Error publicKey",description:"The publicKey is unreadable or not accessible, please check"},{type:103,title:"[103] Bad or empty field",description:"The format is incorrect or the field is empty:"}]},t=function(e,t){if("undefined"==typeof localStorage||void 0===localStorage.getItem)return null;try{return localStorage.getItem("hashKey","1"),localStorage.removeItem("hashKey"),localStorage(e,t)}catch(e){return e,null}},r=function(e,t){if("undefined"==typeof localStorage||void 0===localStorage.setItem)return null;try{return localStorage.setItem("hashKey","1"),localStorage.removeItem("hashKey"),localStorage(e,t)}catch(e){return e,null}},getError=function(e,t,r){$(r).find("button").prop("disabled",!1);let a=ePayco.getLanguage();if("es"==a||"en"==a)var n=languages[ePayco.getLanguage()].errors,o=e;else{var l;n=languages.en.errors,o=e}for(var i=0;i<n.length;i++)o==n[i].type&&(l=n[i]);if(t){var c=l.description.slice(0,47);l.description=c+" "+t}return console.log(l),alert(l.description),l},dump=function(e){return e},a=t("epayco_publish_key"),n=t("epayco_language"),window.ePayco||(window.ePayco={setPublicKey:function(e){"string"==typeof e?r("epayco_publish_key",a=e):getError(102)},setLanguage:function(e){"string"==typeof e?r("epayco_language",n=e):getError(102)},getPublicKey:function(){return a},getLanguage:function(){return n},_errors:{alert:function(e){alert(e)}},_utils:{objectKeys:function(e){var t,r;for(r in t=[],e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},parseForm:function(e){var t,r,a,n,o,l,c,u,s,g,d,p,y,f,m,h,v,b,_,S,P,E,k;if(c={},"object"==typeof e){if("undefined"!=typeof jQuery&&(e instanceof jQuery||"jquery"in Object(e))&&"object"!=typeof(e=e.get()[0]))return{};if(e.nodeType){for(E=e.getElementsByTagName("textarea"),l=e.getElementsByTagName("input"),P=e.getElementsByTagName("select"),t=new Array(E.length+l.length+P.length),i=u=0,b=E.length-1;u<=b;i=u+=1)t[i]=E[i];for(i=p=0,_=l.length-1;p<=_;i=p+=1)t[i+E.length]=l[i];for(i=f=0,S=P.length-1;f<=S;i=f+=1)t[i+E.length+l.length]=P[i];for(h=0,g=t.length;h<g;h++)if((o=t[h])&&(a=o.getAttribute("data-epayco"))){for(k="SELECT"===o.tagName?o.value:o.getAttribute("value")||o.innerHTML||o.value,m=null,y=c,s=null,v=0,d=(n=a.replace(/\]/g,"").replace(/\-/g,"_").split(/\[/)).length;v<d;v++)y[r=n[v]]||(y[r]={}),m=y,s=r,y=y[r];m[s]=k}}else c=e}return c},requestUrl:function(e){(new XMLHttpRequest).withCredentials},createTokenEncrypt:function(t,r,a){var n,o=t;$.ajax({type:"POST",url:e+"token/encrypt",crossDomain:!0,dataType:"json",data:{public_key:ePayco.getPublicKey(),session:o}}).done(function(t){function l(e,t){if(e&&"undefined"!==t)try{return CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),t).toString().toString()}catch(r){return console.log(r),CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),CryptoJS.enc.Utf8.parse(t).toString()).toString()}else console.log("hay algunos valores invalidos")}dump(t),n=t.data.token;var i=JSON.stringify(function(){for(var e=[],t=0;t<r.customer.length;t++)e.push({type:r.customer[t].type,value:l(r.customer[t].value,n)});var a={type:"publicKey",value:ePayco.getPublicKey()},i={type:"session",value:o};return e.push(a),e.push(i),e}());$.ajax({type:"POST",url:e+"token/tokenize",crossDomain:!0,dataType:"json",data:{values:i},error:function(){console.log("No se ha podido obtener la información")}}).done(function(e){(e.data.status="created")?(console.log("created"),a(e.data.token,null)):(console.log("not created"),a(null,e.data.token))}).fail(function(e){dump(e)})}).fail(function(e){dump(e)})},createGuid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},log:function(e){if("undefined"!=typeof console&&console.log)return console.log(e)}}})}).call(this),function(){var e,t,r,a,n,o,l=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};t=[{name:"amex",pattern:/^3[47]/,valid_length:[15]},{name:"diners_club_carte_blanche",pattern:/^30[0-5]/,valid_length:[14]},{name:"diners_club_international",pattern:/^36/,valid_length:[14]},{name:"laser",pattern:/^(6304|670[69]|6771)/,valid_length:[16,17,18,19]},{name:"visa_electron",pattern:/^(4026|417500|4508|4844|491(3|7))/,valid_length:[16]},{name:"visa",pattern:/^4/,valid_length:[16]},{name:"mastercard",pattern:/^5[1-5]/,valid_length:[16]},{name:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,valid_length:[12,13,14,15,16,17,18,19]}],e=["visa","mastercard","maestro","visa_electron","amex","diners_club_carte_blanche","diners_club_international"],r=function(r){var a,n,o,i,c;for(c=function(){var r,n,o,i;for(i=[],r=0,n=t.length;r<n;r++)o=(a=t[r]).name,l.call(e,o)>=0&&i.push(a);return i}(),o=0,i=c.length;o<i;o++)if(n=c[o],r.match(n.pattern))return n;return null},is_valid_luhn=function(e){var t,r,a,n,o,l;for(l=0,n=r=0,a=(o=e.split("").reverse()).length;r<a;n=++r)t=+(t=o[n]),l+=n%2?(t*=2)<10?t:t-9:t;return l%10==0},a=function(e,t){var r;return r=e.length,l.call(t.valid_length,r)>=0},n=function(e){return"string"==typeof e&&e.match(/^[\d]{1,2}$/)?parseInt(e):e},o=function(e){return"number"==typeof e&&e<100&&(e+=2e3),"string"==typeof e&&e.match(/^([\d]{2,2}|20[\d]{2,2})$/)?(e.match(/^([\d]{2,2})$/)&&(e="20"+e),parseInt(e)):e},ePayco.card={},ePayco.card.name=function(e){return(new RegExp).test(e)},ePayco.card.email=function(e){return new RegExp(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(e)},ePayco.card.validateNumber=function(e){var t,n,o;return e="string"==typeof e?e.replace(/[ -]/g,""):"number"==typeof e?e.toString():"",o=!1,n=!1,null!=(t=r(e))&&(o=is_valid_luhn(e),n=a(e,t)),o&&n},ePayco.card.validateCVC=function(e){return"number"==typeof e&&e>=0&&e<1e4||"string"==typeof e&&null!==e.match(/^[\d]{3,4}$/)},ePayco.card.validateExpirationDate=function(e,t){var r,a;return r=n(e),a=o(t),"number"==typeof r&&r>0&&r<13&&"number"==typeof a&&a>2020&&a<2035&&new Date(a,r,new Date(a,r,0).getDate())>new Date}}.call(this),function(){ePayco.token={},ePayco.token.create=function(e,t){var r=ePayco._utils.parseForm(e);if("object"==typeof r&&ePayco._utils.objectKeys(r).length>0)if(r.card){var a,n;function o(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}a={customer:[{type:"name",value:r.card.name,required:!0,validate:ePayco.card.name(r.card.name)},{type:"email",value:r.card.email,required:!0,validate:ePayco.card.email(r.card.email)},{type:"number",value:r.card.number.replace(/ /g,""),required:!0,validate:ePayco.card.validateNumber(r.card.number.replace(/ /g,""))},{type:"cvc",value:r.card.cvc,required:!0,validate:ePayco.card.validateCVC(r.card.cvc)},{type:"date_exp",value:r.card.exp_month+"/"+r.card.exp_year,required:!0,validate:ePayco.card.validateExpirationDate(r.card.exp_month,r.card.exp_year)}]},null==(n=null==localStorage.getItem("keyUserIndex")?localStorage.setItem("keyUserIndex",ePayco._utils.createGuid()):localStorage.getItem("keyUserIndex"))&&(n=localStorage.setItem("keyUserIndex",o()+o()+"-"+o()+"-"+o()+"-"+o()+"-"+o()+o()+o())),sessionID=n||o()+o()+"-"+o()+"-"+o()+"-"+o()+"-"+o()+o()+o();for(var l=0;l<a.customer.length;l++){var i=a.customer[l];if(i.required&&!i.validate){let r=getError(103,i.type,e);return t(r.description,null),!1}}ePayco._utils.createTokenEncrypt(sessionID,a,function(e,r){e?(console.log("1"),t(r,e)):(console.log("2"),t(r,null))})}else getError(101)}}.call(this);